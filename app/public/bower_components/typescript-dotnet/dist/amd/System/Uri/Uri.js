/*!
 * @author electricessence / https://github.com/electricessence/
 * Licensing: MIT https://github.com/electricessence/TypeScript.NET/blob/master/LICENSE.md
 * Based on: https://en.wikipedia.org/wiki/Uniform_Resource_Identifier
 */
define(["require","exports","../Types","../Uri/QueryParams","../Text/Utility","../Uri/Scheme","../Exceptions/ArgumentException","../Exceptions/ArgumentOutOfRangeException"],function(t,e,r,n,u,i,o,s){"use strict";function a(t,e){var r,n=0;for(e||(e={});r=m[n++];){var u=t[r];u&&(e[r]=u)}return e}function f(t){var e=t;if(r["default"].isString(e)){if(!e)return;if(e=i["default"][u.trim(e).toLowerCase().replace(/[^a-z0-9+.-]+$/g,x)],isNaN(e))throw new s["default"]("scheme",t,"Invalid scheme.")}if(r["default"].isNumber(e,!1)){if(e=i["default"][e],!e)throw new s["default"]("scheme",t,"Invalid scheme.");return e}}function c(t){if(!t.host){if(t.userInfo)throw new o["default"]("host","Cannot include user info when there is no host.");if(r["default"].isNumber(t.port,!1))throw new o["default"]("host","Cannot include a port when there is no host.")}var e=t.host||x;return e&&(t.userInfo&&(e=t.userInfo+q+e),isNaN(t.port)||(e+=":"+t.port),e=v+e),e}function l(t){return t&&(-1==t.indexOf(w)?w:x)+t}function h(t){return t&&(-1==t.indexOf(O)?O:x)+t}function p(t){var e=t.path,r=t.query;return x+(e&&(-1==e.indexOf(b)?b:x)+e||x)+(l(r)||x)}function d(t){var e=f(t.scheme),r=c(t),n=p(t),u=h(t.fragment);return x+(e&&e+":"||x)+(r||x)+(n||x)+(u||x)}function g(t,e){if(!t)return new o["default"]("url","Nothing to parse.");var r,n={};if(r=t.indexOf(O),-1!=r&&(n.fragment=t.substring(r),t=t.substring(0,r)),r=t.indexOf(w),-1!=r&&(n.query=t.substring(r),t=t.substring(0,r)),r=t.indexOf(v),-1!=r){var i=u.trim(t.substring(0,r)),s=/:$/;if(!s.test(i))return new o["default"]("url","Scheme was improperly formatted");i=u.trim(i.replace(s,x));try{n.scheme=f(i)||void 0}catch(c){return c}t=t.substring(r+2)}if(r=t.indexOf(b),-1!=r&&(n.path=t.substring(r)||void 0,t=t.substring(0,r)),r=t.indexOf(q),-1!=r&&(n.userInfo=t.substring(0,r)||void 0,t=t.substring(r+1)),r=t.indexOf(":"),-1!=r){var l=parseInt(u.trim(t.substring(r+1)));if(isNaN(l))return new o["default"]("url","Port was invalid.");n.port=l,t=t.substring(0,r)}return t=u.trim(t),t&&(n.host=t),e(a(n)),null}var y=function(){function t(t,e,u,i,o,s,a){var c=this;c.scheme=f(t)||null,c.userInfo=e||null,c.host=u||null,c.port=i||null,c.authority=c.getAuthority()||null,c.path=o||null,r["default"].isString(s)||(s=n.encode(s)),c.query=l(s)||null,Object.freeze(c.queryParams=c.query?n.parseToMap(c.query):{}),c.pathAndQuery=c.getPathAndQuery()||null,c.fragment=h(a)||null,c.absoluteUri=c.getAbsoluteUri(),c.baseUri=c.absoluteUri.replace(/[?#].*/,""),Object.freeze(c)}return t.prototype.equals=function(e){return this===e||this.absoluteUri==t.toString(e)},t.from=function(e,n){var u=!e||r["default"].isString(e)?t.parse(e):e;return new t(u.scheme||n&&n.scheme,u.userInfo||n&&n.userInfo,u.host||n&&n.host,isNaN(u.port)?n&&n.port:u.port,u.path||n&&n.path,u.query||n&&n.query,u.fragment||n&&n.fragment)},t.parse=function(t,e){void 0===e&&(e=!0);var r=null,n=g(t,function(t){r=t});if(e&&n)throw n;return r},t.tryParse=function(t,e){return!g(t,e)},t.copyOf=function(t){return a(t)},t.prototype.copyTo=function(t){return a(this,t)},t.prototype.updateQuery=function(e){var r=this.toMap();return r.query=e,t.from(r)},t.prototype.getAbsoluteUri=function(){return d(this)},t.prototype.getAuthority=function(){return c(this)},t.prototype.getPathAndQuery=function(){return p(this)},Object.defineProperty(t.prototype,"pathSegments",{get:function(){return this.path.match(/^[\/]|[^\/]*[\/]|[^\/]+$/g)},enumerable:!0,configurable:!0}),t.prototype.toMap=function(){return this.copyTo({})},t.prototype.toString=function(){return this.absoluteUri},t.toString=function(e){return e instanceof t?e.absoluteUri:d(e)},t.getAuthority=function(t){return c(t)},t}();Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=y,function(t){t[t.scheme=0]="scheme",t[t.userInfo=1]="userInfo",t[t.host=2]="host",t[t.port=3]="port",t[t.path=4]="path",t[t.query=5]="query",t[t.fragment=6]="fragment"}(e.Fields||(e.Fields={}));var m=e.Fields;Object.freeze(m);var b="/",v="//",w="?",O="#",x="",q="@"});
//# sourceMappingURL=Uri.js.map
